# First we load plugins. On first run it takes a significant amount of
# time and there are output, so I put it before Instant Prompt.
source ~/.zinit/bin/zinit.zsh

zinit wait lucid light-mode for \
  atinit"ZINIT[COMPINIT_OPTS]=-C; zicompinit; zicdreplay" \
    zdharma/fast-syntax-highlighting \
  MichaelAquilina/zsh-you-should-use \
  zsh-users/zsh-history-substring-search \
  wfxr/forgit \
  thetic/extract \
  agkozak/zsh-z 

# blockf will block the traditional method of adding completions
zinit wait lucid light-mode blockf for \
  zsh-users/zsh-completions

zinit wait lucid light-mode svn for \
  OMZ::plugins/command-not-found

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
PS1="READY > "

if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

HISTSIZE=5000 # How many lines of history to keep in memory
HISTFILE=~/.zsh_history # Where to save history to disk
SAVEHIST=5000 # Number of history entries to save to disk

setopt appendhistory # Append history to the history file (no overwriting)
setopt sharehistory # Share history across terminals
setopt incappendhistory # Immediately append to the history file, not just when a term is killed

setopt AUTO_PARAM_SLASH # (autocomplete) If completed parameter is a directory, add a trailing slash
unsetopt MENU_COMPLETE # Do not autoselect the first completion entry
unsetopt FLOW_CONTROL # Disable start/stop characters (^Z, ^C, etc) in shell editor

# switch to emacs mode instead of using vi mode
set -o emacs

# changes hex 0x15 and 0x18 0x7f to delete everything to the left of
# the cursor, rather than the whole line.
# https://stackoverflow.com/a/29403520/2465955
bindkey "^U" backward-kill-line
bindkey "^X\\x7f" backward-kill-line

# bind redo to 0x18 0x1f
bindkey "^X^_" redo

# Register lsd first for ls aliases from prezto utility
alias ls='lsd --group-dirs first'

# Enable command caching and force prefix matching
zstyle ':completion:*' accept-exact '*(N)'
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache

# This loads some crucial environment variables
source $HOME/.shell/.exports

# Load Prezto
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Load my aliases, functions and some external tools
source $HOME/.shell_env

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
